@model PagedResult<Category>

@{
    var language = ViewData["Language"] as string ?? "en";
    ViewData["Title"] = ("مجموعة التصنيفات" , "Category List").Localize(language);
}
@if (!string.IsNullOrEmpty(TempData["Message"] as string))
{
    <div class="alert alert-success mt-3 mb-2 text-white">
        @TempData["message"]
    </div>
}

<div class="d-flex justify-content-center my-3">
    <div class="col-md-5">
        <div class="input-group">
            <input type="text" id="categorySearch"
                   class="form-control text-center fw-bolder bg-white text-primary"
                   placeholder="@(("ابحث باسم التصنيف", "Search by Category name").Localize(language))" />
        </div>
    </div>
</div>

<div id="categoryContainer">
    @{
        var empty = new PagedResult<Category>
            {
                Items = new List<Category>(),
                PageNumber = 1,
                PageSize = 5,
                TotalItems = 0
            };
        await Html.RenderPartialAsync("_Category", empty);
    }
</div>
@section Scripts {
    <script>
        function loadCategories(page = 1, searchText = '') {
            fetch(`/Category/FilterCategories?page=${page}&searchText=${encodeURIComponent(searchText)}`)
                .then(res => res.text())
                .then(html => {
                    document.getElementById("categoryContainer").innerHTML = html;
                });
        }

        document.addEventListener("DOMContentLoaded", () => {
            loadCategories();
        });

        document.getElementById("categorySearch").addEventListener("input", function () {
            clearTimeout(window.debounceTimeout);
            const search = this.value;
            window.debounceTimeout = setTimeout(() => {
                loadCategories(1, search);
            }, 300);
        });

        document.addEventListener("click", function (e) {
            if (e.target.matches(".ajax-page")) {
                e.preventDefault();
                const page = e.target.dataset.page;
                const searchText = document.getElementById("categorySearch").value;
                loadCategories(page, searchText);
            }
        });
        document.addEventListener("click", function (e) {
            if (e.target.matches(".ajax-page")) {
                e.preventDefault();
                const page = e.target.dataset.page;
                const searchText = document.getElementById("categorySearch").value;
                loadCategories(page, searchText);
            }
        });

    </script>
}