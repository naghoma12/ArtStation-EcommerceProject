@model ProductCreation
@{
    var language = ViewData["Language"] as string ?? "en";
}

<p class="text-muted fw-bold nav-heading mt-4 mb-2 bol">
    <span>@(("الصور", "Photos").Localize(language))</span>
</p>

<div class="form-group">
    <label class="form-label">@(("ادخل صور المنتج", "Enter Product Photos").Localize(language))</label>
    <input multiple asp-for="Files" class="form-control form-control-lg" type="file" id="imageUpload" accept=".png,image/png" />
    <p id="error-message" style="color: red; display: none;">Only PNG images are allowed.</p>

    <!-- Existing images -->
    <div class="row mt-3">
        @if (Model.Images != null && Model.Images.Any())
        {
            foreach (var img in Model.Images)
            {
                <div class="col-3 mb-3">
                    <div class="image-container position-relative">
                        <img src="@img" class="img-fluid rounded" alt="Product Image" />
                        <span class="delete-icon position-absolute top-0 end-0 bg-danger text-white px-2 cursor-pointer" style="cursor:pointer;">&#10006;</span>
                    </div>
                </div>
            }
        }
    </div>

    <!-- Preview new uploads -->
    <div id="imagePreview" class="row mt-3"></div>
</div>


<script>
    const imageUpload = document.getElementById("imageUpload");
    const errorMessage = document.getElementById("error-message");
    const previewContainer = document.getElementById("imagePreview");

    imageUpload.addEventListener("change", function () {
        previewContainer.innerHTML = ""; // Clear previous previews
        errorMessage.style.display = "none";

        const files = Array.from(imageUpload.files);
        let isValid = true;

        files.forEach(file => {
            if (file.type !== "image/png") {
                isValid = false;
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                const col = document.createElement("div");
                col.className = "col-3 mb-3";

                col.innerHTML = `
                        <div class="image-container position-relative">
                            <img src="${e.target.result}" class="img-fluid rounded" alt="Preview Image" />
                            <span class="delete-icon position-absolute top-0 end-0 bg-danger text-white px-2" style="cursor:pointer;">&#10006;</span>
                        </div>
                    `;

                // Delete icon removes preview only
                col.querySelector(".delete-icon").addEventListener("click", () => {
                    col.remove();
                    // You can optionally remove the file from the input too, but requires more logic
                });

                previewContainer.appendChild(col);
            };
            reader.readAsDataURL(file);
        });

        if (!isValid) {
            errorMessage.style.display = "block";
            imageUpload.value = ""; // clear invalid input
            previewContainer.innerHTML = ""; // clear preview
        }
    });
</script>
